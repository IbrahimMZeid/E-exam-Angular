<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white">
          <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">
              <i class="fas fa-plus-circle me-2"></i>
              Create New Question
            </h4>
            <button type="button" class="btn btn-outline-light btn-sm" (click)="cancel()">
              <i class="fas fa-times me-1"></i>
              Cancel
            </button>
          </div>
        </div>

        <div class="card-body p-4">
          <form [formGroup]="questionForm" (ngSubmit)="onSubmit()">
            <!-- Question Title -->
            <div class="mb-4">
              <label for="title" class="form-label fw-semibold">
                Question Title <span class="text-danger">*</span>
              </label>
              <textarea id="title" formControlName="title" class="form-control" rows="3"
                placeholder="Enter your question here..."
                [class.is-invalid]="questionForm.get('title')?.invalid && questionForm.get('title')?.touched"></textarea>
              <div class="invalid-feedback"
                *ngIf="questionForm.get('title')?.invalid && questionForm.get('title')?.touched">
                <span *ngIf="questionForm.get('title')?.errors?.['required']">Question title is required.</span>
                <span *ngIf="questionForm.get('title')?.errors?.['minlength']">Question title must be at least 10
                  characters.</span>
              </div>
              <div class="form-text">Write a clear and concise question that students can easily understand.</div>
            </div>

            <!-- Question Details Row -->
            <div class="row g-3 mb-4">
              <!-- Question Type -->
              <div class="col-md-6">
                <label for="type" class="form-label fw-semibold">
                  Question Type <span class="text-danger">*</span>
                </label>
                <select id="type" formControlName="type" class="form-select" (change)="onQuestionTypeChange()"
                  [class.is-invalid]="questionForm.get('type')?.invalid && questionForm.get('type')?.touched">
                  <option value="">Select question type</option>
                  <option [value]="QuestionType.MultipleChoice">Multiple Choice</option>
                  <option [value]="QuestionType.TrueFalse">True/False</option>
                </select>
                <div class="invalid-feedback"
                  *ngIf="questionForm.get('type')?.invalid && questionForm.get('type')?.touched">
                  Please select a question type.
                </div>
              </div>

              <!-- Difficulty Level -->
              <div class="col-md-6">
                <label for="difficulty" class="form-label fw-semibold">
                  Difficulty Level <span class="text-danger">*</span>
                </label>
                <select id="difficulty" formControlName="difficulty" class="form-select"
                  [class.is-invalid]="questionForm.get('difficulty')?.invalid && questionForm.get('difficulty')?.touched">
                  <option value="">Select difficulty</option>
                  <option [value]="DifficultyLevel.Easy">Easy</option>
                  <option [value]="DifficultyLevel.Medium">Medium</option>
                  <option [value]="DifficultyLevel.Hard">Hard</option>
                </select>
                <div class="invalid-feedback"
                  *ngIf="questionForm.get('difficulty')?.invalid && questionForm.get('difficulty')?.touched">
                  Please select a difficulty level.
                </div>
              </div>
            </div>

            <!-- Subject and Score Row -->
            <div class="row g-3 mb-4">
              <!-- Subject -->
              <div class="col-md-8">
                <label for="subjectId" class="form-label fw-semibold">
                  Subject <span class="text-danger">*</span>
                </label>
                <select id="subjectId" formControlName="subjectId" class="form-select"
                  [class.is-invalid]="questionForm.get('subjectId')?.invalid && questionForm.get('subjectId')?.touched">
                  <option value="">Select subject</option>
                  <option *ngFor="let subject of subjects" [value]="subject.id">
                    {{ subject.name }}
                  </option>
                </select>
                <div class="invalid-feedback"
                  *ngIf="questionForm.get('subjectId')?.invalid && questionForm.get('subjectId')?.touched">
                  Please select a subject.
                </div>
              </div>

              <!-- Score -->
              <div class="col-md-4">
                <label for="score" class="form-label fw-semibold">
                  Score <span class="text-danger">*</span>
                </label>
                <input type="number" id="score" formControlName="score" class="form-control" min="1" max="100"
                  [class.is-invalid]="questionForm.get('score')?.invalid && questionForm.get('score')?.touched">
                <div class="invalid-feedback"
                  *ngIf="questionForm.get('score')?.invalid && questionForm.get('score')?.touched">
                  <span *ngIf="questionForm.get('score')?.errors?.['required']">Score is required.</span>
                  <span *ngIf="questionForm.get('score')?.errors?.['min']">Score must be at least 1.</span>
                  <span *ngIf="questionForm.get('score')?.errors?.['max']">Score cannot exceed 100.</span>
                </div>
              </div>
            </div>

            <!-- Options Section -->
            <div class="mb-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0 fw-semibold">
                  <i class="fas fa-list-ul me-2"></i>
                  Answer Options
                </h5>
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="addOption()"
                  *ngIf="isMultipleChoice">
                  <i class="fas fa-plus me-1"></i>
                  Add Option
                </button>
              </div>

              <div formArrayName="options" class="options-container">
                <div *ngFor="let option of optionsArray.controls; let i = index" [formGroupName]="i"
                  class="option-item border rounded p-3 mb-3">
                  <div class="row align-items-center">
                    <div class="col-md-1">
                      <div class="form-check">
                        <input title="Correct Option" class="form-check-input" type="radio" [name]="'correctOption'"
                          [id]="'correct' + i" [checked]="option.get('isCorrect')?.value"
                          (change)="onCorrectOptionChange(i)">
                        <label class="form-check-label" [for]="'correct' + i">
                          Correct
                        </label>
                      </div>
                    </div>
                    <div class="col-md-9">
                      <input title="Option" type="text" class="form-control" formControlName="title"
                        [placeholder]="'Option ' + (i + 1)"
                        [class.is-invalid]="option.get('title')?.invalid && option.get('title')?.touched"
                        (input)="onOptionTextChange()">
                      <div class="invalid-feedback"
                        *ngIf="option.get('title')?.invalid && option.get('title')?.touched">
                        <span *ngIf="option.get('title')?.errors?.['required']">Option text is required.</span>
                        <span *ngIf="option.get('title')?.errors?.['duplicate']">This option already exists.</span>
                      </div>
                    </div>
                    <div class="col-md-2 text-end">
                      <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeOption(i)"
                        *ngIf="optionsArray.length > 2 && isMultipleChoice">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="alert alert-info" *ngIf="questionForm.get('type')?.value === QuestionType.TrueFalse">
                <i class="fas fa-info-circle me-2"></i>
                For True/False questions, select the correct answer by clicking the radio button next to "True" or
                "False".
              </div>
            </div>

            <!-- Form Actions -->
            <div class="d-flex justify-content-end gap-3">
              <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="isLoading">
                <i class="fas fa-times me-1"></i>
                Cancel
              </button>
              <button type="submit" class="btn btn-primary" [disabled]="questionForm.invalid || isLoading">
                <i class="fas fa-save me-1" *ngIf="!isLoading"></i>
                <span class="spinner-border spinner-border-sm me-1" *ngIf="isLoading"></span>
                {{ isLoading ? 'Creating...' : 'Create Question' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
